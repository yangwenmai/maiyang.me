---
title: 'TiDB Hackathon 2019 ä¹‹ Manage many as one with SQL'
keywords: pingcap, tidb, pd, tikv, go, rust, hackathon, beijing, shanghai, guangzhou
date: 2019-10-30T22:20:00+08:00
lastmod: 2019-10-30T22:20:00+08:00
draft: true
description: 'ç”¨ SQL æŸ¥è¯¢é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯ï¼›ç”¨ SQL ä¿®æ”¹é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„é…ç½®ã€‚'
categories: [hackathon]
tags: [pingcap, tidb, pd, tikv, go, rust, hackathon, beijing, shanghai, guangzhou]
comments: true
author: æ¨æ–‡, é™ˆéœœ, é‚“åŠ›é“­, å”ä¼Ÿå¿—
---

å»å¹´å‚åŠ [TiDB Hackathon 2018 ä¹‹å¤©çœŸè´å¶æ–¯å­¦ä¹ æœº](https://maiyang.me/post/2018-12-03-the-road-hackathon-in-tidb/)ï¼Œå¾ˆå¹¸è¿è·å¾—äº†ä¸‰ç­‰å¥–ï¼Œä»Šå¹´è·Ÿç€å‡ ä½å¤§ä½¬å†æ¬¡ä¸­å¥–ï¼Œéå¸¸å¼€å¿ƒã€‚

è¿™ä¸€æ¬¡ç›¸è¾ƒä¸Šä¸€æ¬¡ï¼Œå¾ˆä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯æ›´æ·±å…¥ TiDB äº†ï¼Œæ¯”æ–¹è¯´ TiDBã€PDã€TiKV å…¨éƒ¨éƒ½æœ‰æ¶‰åŠï¼Œå¹¶ä¸”è¿˜ä¼šå…¨éƒ¨è¿›è¡Œæ”¹é€ ã€‚è¿˜æœ‰æ·±å…¥äº†è§£äº† PingCAP ç ”å‘åŒå­¦çš„å·¥ä½œæ¨¡å¼ã€‚
>Hackathon çœŸçš„éå¸¸ä¸é”™ï¼Œæ˜å¹´èƒ½å¦å†ç»™ä¸€ä¸ªæŠ±å¤§è…¿çš„æœºä¼šå‘€ï¼Ÿ

## ç®€è¿°

æœ¬æ¬¡ Hackathon çš„ä¸»é¢˜æ˜¯ â€œTiDB Improveâ€ ï¼Œæˆ‘ä»¬å°ç»„éƒ½ä¸æ˜¯äº‹å…ˆç»„é˜Ÿçš„ï¼Œè€Œæ˜¯åœ¨å›½åº†åæŠ¥åï¼Œç”±ç»„å§”ä¼šåˆ†é…çš„

ç¼˜åˆ†å•Šï¼ï¼ï¼

ç»„åï¼šâ€œåšä¸ªäººå§â€ï¼Œå…¶å®æˆ‘åˆ°ç°åœ¨ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå–è¿™ä¸ªåå­—ã€‚

åœ¨10æœˆ11æ—¥å°ç»„æ­£å¼æˆç«‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰ç¡®å®šæä»€ä¹ˆä¸»é¢˜ï¼Œæ‰€ä»¥å°ç»„ä¹Ÿåªæ˜¯åä¹‰ä¸Šæˆç«‹äº†è€Œå·²ï¼Œå®é™…ä¸Šä»€ä¹ˆéƒ½æ²¡æœ‰åšã€‚

## å‡†å¤‡å·¥ä½œ

æˆ‘ä»¬å°ç»„çš„é¢˜ç›®æ˜¯åœ¨10æœˆ14æ—¥æˆ‘å» PingCAP å…¬å¸å‚åŠ  Talent Plan å…¬å¼€è¯¾ï¼Œè·Ÿå°ç»„çš„2ä¸ªç»„å‘˜è§é¢ï¼Œç„¶åè·Ÿå‡ ä½å¯¼å¸ˆæ²Ÿé€šä¹‹åç¡®å®šçš„ã€‚
>å†æ¬¡æ„Ÿè°¢å¯¼å¸ˆç»™æˆ‘ä»¬çš„è®®é¢˜å»ºè®®ï¼Œä»¥åŠåç»­æ•´ä¸ªè¿‡ç¨‹ä¸­ç»™äºˆçš„å¸®åŠ©ã€‚

è¯´æ¥ä¹Ÿå·§ï¼Œä¸œæ—­åœ¨10æœˆ17æ—¥å‘è¡¨äº†ä¸€ç¯‡æ–‡ç« ï¼š[Hands on! å¦‚ä½•ç»™ TiDB æ·»åŠ æ–°ç³»ç»Ÿè¡¨](https://mp.weixin.qq.com/s/CsCPeqXj6V9Bd6h3pMeI8w)
>å¯¹æˆ‘ä»¬å¸®åŠ©è¿˜è›®å¤§çš„ã€‚

### hackathon æ¯”èµ›é¡¹ç›®è§„åˆ’

è¿™ä¸ªå·¥ä½œä¸»è¦æ˜¯ç”±æˆ‘ä»¬çš„å°ç»„ç»„é•¿é™ˆéœœè´Ÿè´£çš„ã€‚

### å°ç»„çº¿ä¸Šè®¨è®º

10æœˆ16æ—¥ï¼Œä¼Ÿå¿—åœ¨ç¾¤å†…è¯¢é—®åˆ°æˆ‘ä»¬é¡¹ç›®è¦å¦‚ä½•å¼€å±•ï¼Ÿç„¶åæˆ‘ä»¬ä¹˜æœºå°±å¬å¼€äº†çº¿ä¸Šç¬¬ä¸€æ¬¡å°ç»„è®¨è®ºã€‚

åœˆé‡ç‚¹ï¼š

>tidb ä¹‹é—´çš„ rpc æ¡†æ¶çš„åŠŸèƒ½æ˜¯å¯ä»¥æŠŠ executor ç®—å­æ¨ç»™åˆ«çš„ TiDB ä¸€èµ·æ‰§è¡Œï¼Œ
ä½†æ˜¯æ¡†æ¶æ­å¥½åï¼Œå°±éœ€è¦å±•ç¤ºä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„ä½œç”¨ï¼Œæˆ‘ç›®å‰èƒ½æƒ³åˆ°çš„2ä¸ªç‚¹å°±æ˜¯ï¼š
ä»æ€§èƒ½æ–¹é¢ï¼šå¼„ä¸€ä¸ªåˆ†å¸ƒå¼çš„è®¡ç®—ï¼Œæ¯”å¦‚å¤šä¸ªè¡¨çš„ join, æˆ–è€…ä¸¤ä¸ªå¤§è¡¨çš„ join, æˆ‘ä»¬å¯ä»¥æŠŠ join å¹¶è¡Œæ¨åˆ° å„ä¸ª TiDB ä¸Šé¢å»å¹¶è¡Œçš„åšï¼Œä½†æ˜¯è¿™ä¸ªå¯èƒ½æ¯”è¾ƒéš¾åšï¼Œ
ä»æ˜“ç”¨æ€§æ–¹é¢ï¼ŒTiDB çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯å¯èƒ½æ˜¯å­˜åœ¨å†…å­˜è¡¨é‡Œé¢çš„ï¼Œä»¥å‰è®¿é—®ä¸€å° TiDB æŸ¥è¯¢è¯¥ TiDB çš„ä¿¡æ¯æ—¶ï¼Œåªèƒ½æŸ¥å½“å‰ TiDB çš„çŠ¶æ€ä¿¡æ¯ï¼Œæœ‰ äº† rpc æ¡†æ¶åï¼Œå¯ä»¥ç›´æ¥æŸ¥æ‰€æœ‰ tidb çš„çŠ¶æ€ä¿¡æ¯ï¼Œç”Ÿæˆç›¸åŒçš„ç®—å­å‘ç»™æ‰€æœ‰çš„ TiDB ï¼Œç„¶åä¸Šé¢ç”¨ä¸€ä¸ª Union all ç®—å­å³å¯ã€‚ è¿™ä¸ªæ¯”è¾ƒå¥½åšï¼Œä½†æ˜¯ç›®å‰ TiDB è‡ªèº«çŠ¶æ€ä¿¡æ¯ç›¸å…³çš„ å†…å­˜è¡¨å¾ˆå°‘ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å»åŠ ï¼Œæ¯”å¦‚ TiDB çš„ cpu ä½¿ç”¨ç‡ï¼Œå†…å­˜ï¼Œè¿æ¥æ•°ç­‰ç­‰ï¼Œ æˆ‘ä»¬å¯ä»¥è‡ªå·±åŠ ç§å†…å­˜è¡¨ï¼Œè¿™ä¸ªä¹Ÿæ˜“äºåˆ†å·¥ï¼Œæ¯ä¸ªäººåˆ†1ï¼Œ2 ä¸ªå†…å­˜è¡¨å»å®ç°ï¼Œ å…·ä½“å“ªäº›å†…å­˜è¡¨ï¼Œæˆ‘ä¹Ÿè¿˜æ²¡æƒ³å¥½ï¼Œå¤§å®¶ä¸€èµ·æƒ³æƒ³å§ï¼Œå¯ä»¥å‚è€ƒ mysql, orcal ç­‰ï¼Œ mysql æœ‰ä¸€ä¸ª perfomance db é‡Œé¢ç»´æŠ¤äº†ä¸€äº› å†…å­˜è¡¨ï¼Œå¯ä»¥å‚è€ƒä¸‹ ï¼Œ è¿™ä¸ªåšèµ·æ¥æ¯”è¾ƒç®€å•
**TiDB è‡ªå·±çš„çŠ¶æ€ç»Ÿè®¡åšæˆä¸€ä¸ªå†…å­˜è¡¨å°±å¥½äº†ï¼Œä¿¡æ¯å°±åœ¨å†…å­˜é‡Œé¢ï¼Œåªæ˜¯æ±‡æ€»é›†ç¾¤é‡Œé¢æ‰€æœ‰ TiDB çš„ç»Ÿè®¡ä¿¡æ¯å°±è¦èµ° rpc æ¡†æ¶ã€‚**

å…¶ä»–å°±ä¸å¤šè´´äº†ï¼Œåæ­£å°±æ˜¯è¯é¢˜ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œå·®ä¸å¤šç®—æ˜¯å®šä¸‹æ¥äº†ã€‚

----

è¿‡äº† 5 å¤©ï¼Œæˆ‘ä»¬å°ç»„å¬å¼€äº†ç¬¬ä¸€æ¬¡ zoom åœ¨çº¿è§†é¢‘ä¼šè®®ã€‚

### å°ç»„ç¬¬ä¸€æ¬¡ä¼šè®®ï¼ˆå”¯ä¸€ä¸€æ¬¡ï¼‰

10æœˆ21æ—¥20ç‚¹30åˆ†ä¸¾è¡Œäº†å°ç»„æˆç«‹ä»¥æ¥çš„ç¬¬ä¸€æ¬¡æ­£å¼ä¼šè®®ï¼Œä¹Ÿæ˜¯å”¯ä¸€çš„ä¸€æ¬¡æ­£å¼ä¼šè®®ã€‚

ä¼šè®®ä¸»è¦æ˜¯ç¡®å®šäº†æˆ‘ä»¬è¦åšçš„é¡¹ç›®å…·ä½“æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¤§æ¦‚çš„åˆ†å·¥ï¼Œå½¼æ­¤ä¹Ÿåœ¨ zoom ä¼šè®®ä¸Šè¿›è¡Œäº†ç›¸äº’çš„è®¤è¯†ã€‚

----

## ç›®æ ‡

ç”¨ SQL è·å–é›†ç¾¤ç±»æ‰€æœ‰èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼Œå°†ç›¸å…³ä¿¡æ¯æ˜ å°„æˆä¸€å¼ ç³»ç»Ÿè¡¨ï¼Œå¸®åŠ©æ›´å¿«çš„å®šä½é—®é¢˜ã€‚

node_info ï¼ˆå„ä¸ªèŠ‚ç‚¹ç»´æŠ¤å„è‡ªçš„ä¿¡æ¯ï¼‰
 
|cpu | net | memory | disk | node_type | ip | id |
|xx | xx| xx| xx| tidb| xx| tidb_1|

...

cluster_node_infos ï¼ˆ TiDB æ±‡æ€»æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯å½¢æˆç³»ç»Ÿè¡¨ï¼‰

|cpu | net | memory | disk | node_type | ip | id |
|xx| xx| xx| xx| tidb| xx| tidb_1|
|xx| xx| xx| xx| tikv| xx| tikv_1|
|xx| xx| xx| xx| tikv| xx| pd_1|

## é—®é¢˜

- Slow_query, Statement, ProcessList å†…å­˜è¡¨ç›®å‰éƒ½æ˜¯å•æœºçš„ã€‚
	å¦‚ä½•è¿ä¸Šä¸€å° TiDB åï¼Œæ‰§è¡Œ `Select * from slow_query;` å¯ä»¥è·å–æ‰€æœ‰ TiDB èŠ‚ç‚¹é‡Œå†…å­˜è¡¨çš„æ•°æ®?
- å¦‚ä½•ç”¨ SQL è·å–æ‰€æœ‰èŠ‚ç‚¹çš„ CPU, memory, heap ç­‰ä¿¡æ¯?

## è§£å†³æ–¹æ¡ˆ

1. è·å–æ‰€æœ‰ TiDB èŠ‚ç‚¹çš„ä¿¡æ¯ï¼šRPC æ¡†æ¶ï¼Œç±»ä¼¼ coprocessorï¼›
2. è·å– TiKV èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ–°å¢ MemTableScan ç®—å­ï¼ŒTiKV èŠ‚ç‚¹è‡ªå·±ç»´æŠ¤ä¸€ä»½ç±»ä¼¼å†…å­˜è¡¨çš„æ•°æ®ï¼Œç”¨ MemTableScan æ¥è·å–å†…å­˜è¡¨æ•°æ®çš„å†…å®¹ï¼›
3. è·å– PD èŠ‚ç‚¹çš„ä¿¡æ¯ï¼šç”¨ PD Client æš´éœ²å‡ºä¸€ä¸ªæ¥å£? 

## åˆ†å·¥

- TiDB ä¹‹é—´ RPC æ¡†æ¶çš„å®ç° @é™ˆéœœ
- æ–°å¢ MemTableScan ç®—å­ï¼Œè®¿é—® TiKV èŠ‚ç‚¹çš„æ•°æ® @é‚“åŠ›é“­
- æ–°å¢ PD client æ¥å£ï¼Œè®¿é—® PD èŠ‚ç‚¹çš„æ•°æ® @æ¨æ–‡
- æ–°å¢æ›´å¤š TiDB çš„å†…å­˜è¡¨ï¼Œå‚è€ƒ: Hands-on! å¦‚ä½•ç»™ TiDB æ·»åŠ æ–°ç³»ç»Ÿè¡¨ @å”ä¼Ÿå¿—

>ä¼šè®®ä¹‹åï¼Œå…¶å®æˆ‘ä»¬æ•´ä¸ªè§„åˆ’è¿˜ç®—æ¯”è¾ƒå®Œæ•´äº†ï¼Œå¤§å®¶åŸºæœ¬ä¸Šä¹Ÿéƒ½å„å¸å…¶èŒå¼€å§‹ç ”ç©¶å’Œç†Ÿæ‚‰ã€‚

## å¼€èµ›

å°ç»„æˆå‘˜é™†é™†ç»­ç»­ï¼Œåœ¨9ç‚¹30åˆ†éƒ½èµ¶åˆ°äº†èµ›åœºï¼Œæˆ‘å› ä¸ºä¸€äº›åŸå› è¿Ÿåˆ°äº†ï¼Œå·®ä¸å¤š9ç‚¹50åˆ†æ‰èµ¶åˆ°ã€‚

9ç‚¹30åˆ†å¼€å§‹çš„ hackathon å¼€åœºä¼šä¹Ÿåªå¬äº†ä¸€éƒ¨åˆ†ã€‚

ä¸è¿‡ï¼Œæˆ‘ä»¬å°ç»„æ¯ä¸ªäººåœ¨10ç‚¹é’Ÿä¹Ÿéƒ½å…¨éƒ¨å¿«é€Ÿè¿›å…¥çŠ¶æ€äº†ï¼ŒæŠŠä¹‹å‰å®šä¸‹æ¥çš„è®¡åˆ’åˆé‡æ–°æ˜ç¡®äº†ä¸€éï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å°†è¦æ”¶é›†çš„ä¿¡æ¯å®šä¹‰å¥½æ•°æ®ç»“æ„äº†ã€‚

## è°ƒç ”

- https://github.com/shirou/gopsutil å¥½åƒæœ‰ä¸€äº› CPUã€å†…å­˜ä¿¡æ¯çš„é‡‡é›†ã€‚
- prometheus-go-client å¦‚ä½•æ”¶é›† CPUï¼Œå†…å­˜ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒå…¶æºç å®ç°ï¼Œæˆ‘ä»¬è¿›è¡Œå€Ÿé‰´ã€‚
- https://github.com/zcalusic/sysinfo/ å‚èµ›å½“å¤©è¿›è¡Œçš„å®é™…è°ƒç ”å’Œè°ƒè¯•ã€‚

å› ä¸ºæˆ‘ä»¬å°ç»„æˆå‘˜ï¼Œéƒ½æ²¡æœ‰ä½¿ç”¨è¿‡ä»¥ä¸Šç»„ä»¶ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„è°ƒç ”ä¸»è¦æ˜¯æˆ‘å’Œå”ä¼Ÿå¿—è´Ÿè´£ã€‚

ç»è¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šç¡®å®šçš„æ–¹æ¡ˆæ˜¯ï¼š

- https://github.com/zcalusic/sysinfo/ è´Ÿè´£é™æ€æ•°æ®çš„é‡‡é›†ï¼›
- https://github.com/shirou/gopsutil/ è´Ÿè´£åŠ¨æ€æ•°æ®çš„é‡‡é›†ï¼›

## ä¸ŠæŠ¥æ•°æ®æ–¹å¼

1. TiDB å†…ä½¿ç”¨å†…å­˜è¡¨ï¼›
2. TiDB ä¸ TiKV ä½¿ç”¨åŸæœ‰çš„ RPCï¼›
3. TiDB ä¸ PD ä½¿ç”¨ HTTP APIï¼›ï¼ˆè°ƒç ”å‘ç° PD Client RPC æ¯”è¾ƒé‡å’Œéº»çƒ¦ï¼‰

## hackathon ç¬¬ä¸€å¤©

ä¸Šåˆï¼š
è¿›å…¥çŠ¶æ€æ¯”è¾ƒæ…¢ï¼Œç¼–ç ä¸å¤šï¼Œä¸»è¦æ˜¯ç†Ÿæ‚‰ç¯å¢ƒï¼Œäº†è§£æ¯”èµ›ä¸»é¢˜å’Œå®é™…ç»†åŒ–çš„åˆ†å·¥ï¼Œç„¶åè¿›è¡ŒæŠ€æœ¯æ–¹æ¡ˆçš„è°ƒç ”ã€‚

åˆé¤ï¼š
ä¸­åˆ12ç‚¹ï¼Œç»„å§”ä¼šçš„å°ä¼™ä¼´ä»¬æœåŠ¡éå¸¸å‘¨åˆ°ï¼Œè®¢çš„åˆé¤åˆ°äº†ï¼Œå¤§å®¶éƒ½å‡†ç‚¹å»åƒé¥­äº†ã€‚ï¼ˆè‚¯å®šè¦åƒé¥±äº†æ‰èƒ½å¹²æ´»çš„ã€‚ï¼‰
>å¤§å®¶ç›¸äº’è®¤è¯†ç†Ÿæ‚‰ï¼Œé¢åŸº partyï¼›

ä¸‹åˆï¼š

åƒé¥­åï¼Œä¸€å¼€å§‹å¹²åŠ²åè¶³ï¼Œä¸è¿‡éšç€è¿™ä¸ªé¥­æ™•é€æ­¥èµ·æ•ˆï¼Œåˆ°13ç‚¹30å¤šå®åœ¨æ‰›ä¸ä½ï¼Œæˆ‘å°±è¶´åœ¨æ¡Œå­ä¸Šåˆä¼‘äº†30æ¥åˆ†é’Ÿï¼Œç„¶åèµ·æ¥ä¹‹åæ´»åŠ¨æ´»åŠ¨ï¼Œç»§ç»­ hackathon ï¼Œå¾ˆå¿«å°±æ‰“é€šäº†æœ¬åœ°é‡‡é›†é¡¹çš„å•å…ƒæµ‹è¯•ï¼Œéšåéƒ¨ç½²åˆ° Linux ä¸Šè¿›è¡Œå®é™…é‡‡é›†æµ‹è¯•ï¼Œçœ‹èµ·æ¥æ•°æ®é¡¹å„æ–¹é¢éƒ½æ­£å¸¸ã€‚

æƒ³åŠæ³•è¿›è¡Œæœ¬åœ°é›†ç¾¤æµ‹è¯•ï¼Œç„¶ååˆ°çº¿ä¸Šé¢„åˆ†é…æœºå™¨å®‰è£…é›†ç¾¤ï¼Œç„¶åè¿›è¡Œæµ‹è¯•ã€‚

ä¹Ÿä¸çŸ¥é“å¹²äº†å¤šå°‘äº‹ï¼Œåˆå«å¤§å®¶åƒé¥­äº†ã€‚ã€‚ã€‚ã€‚
>æ—¶é—´ä¸ç»ç”¨å•Š~~~

æ™šä¸Šï¼š
æ™šé¤çœŸçš„æ˜¯å¼‚å¸¸ä¸°å¯Œï¼Œæœ‰å„ç§å£å‘³çš„å°é¾™è™¾ã€‚
>äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬çš„æˆ˜æ–—åŠ›ä¸æ€ä¹ˆå¼ºï¼Œå°é¾™è™¾å±…ç„¶è¿˜è¿‡å¤œäº†ï¼Œåˆ°ç¬¬äºŒå¤©é¢å¥–ç»“æŸæ—¶ï¼Œéƒ½è¿˜æœ‰ä¸€ç›’å°é¾™è™¾ã€‚

ä¸»è¦æ˜¯ TiDB å†…å­˜è¡¨çš„è°ƒè¯•ï¼Œä»¥åŠå’Œ PD çš„è”è°ƒæµ‹è¯•ã€‚

è”è°ƒä¹Ÿæ²¡æœ‰é‡åˆ°ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯å¼€å‘çš„ç¨‹åºè¿˜æ˜¯æœ‰ä¸å°‘å¯ä¼˜åŒ–çš„ï¼Œæ‰€ä»¥ä¸€ç›´æŒç»­åœ¨æ”¹è¿›ã€‚

æˆ‘ä¸€ç›´è¢«ä¸€ä¸ª etcd è®¿é—®æ€»æ˜¯è¿”å› leader èŠ‚ç‚¹çš„é‡‡é›†æ•°æ®çš„é—®é¢˜å¡ä½ï¼Œè°ƒè¯•åˆ°å‡Œæ™¨4ç‚¹å¤šä¹Ÿæ²¡æœ‰è§£å†³ã€‚ï¼ˆæ‰¾åˆ°é—®é¢˜ç‚¹ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æƒ³åˆ°è‡ªè®¤ä¸ºæ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼‰
>æˆ‘å°è¯•è§£å†³ï¼Œä¸€ç›´æŒç»­åˆ°4ç‚¹å¤šï¼Œå®åœ¨æ˜¯æ‰›ä¸ä½äº†ï¼Œæˆ‘å°±å»ç¡äº†ï¼Œæˆ‘ä»¬ç»„é•¿é™ˆéœœå¤§ç¥ï¼Œå±…ç„¶åœ¨æˆ‘ç¡åå¸®æˆ‘æŠŠå¡ä½çš„é—®é¢˜ç»™è§£å†³äº†ã€‚ï¼ˆé€ä¸ª ğŸ‘ï¼‰ã€è§£å†³æ–¹æ³•ä¹Ÿæ¯”è¾ƒ hack å“¦ã€‘

`newRedirector.ServeHTTP` ä¸­ä¼šå¯¹è®¿é—®èŠ‚ç‚¹æ˜¯å¦æ˜¯ Leader è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸æ˜¯ä¼šå»éå†èŠ‚ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ° Leader èŠ‚ç‚¹ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬è®¿é—® member ipï¼Œè¿”å›çš„ä¾ç„¶æ˜¯ Leader çš„æ•°æ®ã€‚

æˆ‘ä»¬æœ¬æ¥æ˜¯æƒ³å‚è€ƒ Oracle AWR å¯¹å‚èµ›é¡¹ç›®è¿›è¡ŒåŠ ç çš„ï¼Œä½†æ˜¯å› ä¸ºè”è°ƒçš„é—®é¢˜ï¼Œè€½è¯¯äº†ä¸å°‘æ—¶é—´ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„å¼ºåŠ›ä¼˜åŒ–ï¼Œåªèƒ½æœŸå¾…ä»¥åäº†ã€‚

## hackathon ç¬¬äºŒå¤©

æˆ‘å’Œå”ä¼Ÿå¿—ï¼Œå…¶å®åœ¨ç¬¬ä¸€å¤©çš„æ—¶å€™åŸºæœ¬ä¸Šå·²ç»æŠŠåˆ†å·¥çš„ä»»åŠ¡éƒ½å®Œæˆçš„å·®ä¸å¤šäº†ã€‚
æ‰€ä»¥ç¬¬äºŒå¤©ï¼Œä¸»è¦æ˜¯æµ‹è¯•ï¼Œä»¥åŠæ„å»ºæœ¬åœ° TiDB é›†ç¾¤æµ‹è¯•ã€‚

æˆ‘ä¹Ÿå°è¯•ç€å»é˜…è¯»äº†æ›´å¤šçš„æºä»£ç ï¼Œå»å¯»æ‰¾é—®é¢˜çš„æ ¹æºã€‚ï¼ˆç»ˆäºæ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æºï¼‰----ä¸æŠ›å¼ƒä¸æ”¾å¼ƒï¼Œç»ˆä¼šæ˜ç™½ã€‚

## é—®é¢˜

1. Mac ä¸ŠåŸºæœ¬ä¸Šæ— æ³•è·å–åˆ° CPU, MEMORY, DISK ç­‰ä¿¡æ¯ï¼›ï¼ˆåº“å¯¹ Linux æ‰æ”¯æŒæ¯”è¾ƒå¥½ï¼‰ï¼›
2. https://github.com/zcalusic/sysinfo/ åœ¨ Mac ä¸Šç¼–è¯‘æŠ¥é”™ï¼šæ— æ³•è¯†åˆ« syscall.Utsname ï¼›
3. TiDB æœ¬åœ°é›†ç¾¤è”è°ƒï¼ˆéœ€è¦ç¼–è¯‘å¯ç”¨çš„ TiDB, PD, TiKV binaryï¼‰ï¼›
4. TiDB ä¸ TiKV è”è°ƒï¼ˆ@é‚“åŠ›é“­ è¡¥å……ï¼‰ï¼›
5. å…¶ä»–é—®é¢˜è¡¥å……ï¼ˆ@é™ˆéœœã€@é‚“åŠ›é“­ã€@å”ä¼Ÿå¿—ï¼‰ï¼›

### é—®é¢˜å…­

API è®¿é—® member çš„ node_info æ—¶ï¼Œè¿”å›äº† Leader çš„æ•°æ®ã€‚
è™½ç„¶ä¸€å¼€å§‹æˆ‘éƒ½å®šä½åˆ°äº†äº§ç”Ÿé—®é¢˜çš„åœ°æ–¹ï¼Œä½†æ˜¯æˆ‘ä¸€æ ¹ç­‹çš„åœ¨æ€è€ƒçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šé‡æ–°å®šä¹‰è·¯ç”±æ ¹èŠ‚ç‚¹ï¼Œä»¥åŒºåˆ†å¼€ `/pd` ï¼Œæ¯”æ–¹è¯´ `/pd_cluster` ï¼Œä»¥ä½¿å¾—è¿™æ¬¡è°ƒæ•´å¯ä»¥æ›´å…·æœ‰å¯æ‰©å±•æ€§ã€‚

æˆ‘çš„æƒ³æ³•æ˜¯ï¼š

ç»™ mux å¢åŠ ä¸€ä¸ªæ–°çš„ prefix ï¼Œä½†æ˜¯æŸ¥é˜…äº†å„ç§è®¾ç½® router çš„ prefix æ–‡æ¡£ä¹‹åï¼Œæµ‹è¯•å¯ä»¥ï¼Œä½†æ˜¯åœ¨ PD ä¸­å°±æ˜¯ä¸€ç›´ä¸èƒ½ç”Ÿæ•ˆï¼Œæ€»æ˜¯æŠ¥é”™ï¼š404 Not Foundï¼Œå½“æ—¶å¤´è„‘å‘çƒ­çš„å°±ä¸€ç›´æªç€è¿™ä¸ª 404 ä¸æ”¾ã€‚
>å°è¯•è¿‡å»è°ƒå–æ•´ä¸ªå®šä¹‰çš„é…ç½®è·¯ç”±è¡¨ã€‚æˆ‘ä¸€ç›´æƒ³æ–¹è®¾æ³•å»æ‰¾ä¸ºä»€ä¹ˆ 404ï¼Œå…¶å®è¿™ä¸ªæ€è·¯æ˜¯ä¸å¯¹çš„ã€‚

ç¬¬äºŒå¤©ï¼Œå¤´è„‘æ¸…é†’æ—¶ï¼Œå‘ç°åŸæ¥ etcd åªå®šä¹‰äº† `/pd`

```golang
	etcdCfg.UserHandlers = map[string]http.Handler{
		pdAPIPrefix: apiRegister(s),
	}
```

æ‰€ä»¥æˆ‘è®¾ç½® prefix çš„ router æ˜¯æ— æ³•ç”Ÿæ•ˆçš„ã€‚


## å‚è€ƒèµ„æ–™

1. [Hackathon TiDB/TiKV å‚è€ƒæ–‡æ¡£èµ„æ–™æ±‡æ€»](https://github.com/pingcap/presentations/blob/master/hackathon-2019/reference-document-of-hackathon-2019.md)
2. [TiDB Hackathon 2019 å®Œæ•´å‚èµ›é¡¹ç›®å±•ç¤º](https://github.com/pingcap/presentations/blob/master/hackathon-2019/hackathon-2019-projects.md)
3. [Manage many as one with SQL Slides](https://docs.google.com/presentation/d/1sWG4LYnW-LHAPgDa1HoT6uvFwCfKDCYR47mCjOoLSf4/edit#slide=id.g6f8409298b_0_149)

----

**èŒ¶æ­‡é©¿ç«™**

ä¸€ä¸ªå¯ä»¥è®©ä½ åœä¸‹æ¥çœ‹ä¸€çœ‹ï¼Œåœ¨èŒ¶æ­‡ä¹‹ä½™ç»™ä½ å¸®åŠ©çš„å°ç«™ï¼Œè¿™é‡Œçš„å†…å®¹ä¸»è¦æ˜¯åç«¯æŠ€æœ¯ï¼Œä¸ªäººç®¡ç†ï¼Œå›¢é˜Ÿç®¡ç†ï¼Œä»¥åŠå…¶ä»–ä¸ªäººæ‚æƒ³ã€‚

![èŒ¶æ­‡é©¿ç«™äºŒç»´ç ](https://raw.githubusercontent.com/yangwenmai/maiyang.me/master/blog/tech_tea.jpg)
