---
title: 'Go Release Archive Size up! up! up!'
keywords: Go, Golang, Archive, Size, Analyze
date: 2020-07-16T19:24:00+08:00
lastmod: 2020-07-16T19:24:00+08:00
draft: false
description: 'Go å‘å¸ƒåŒ…å¤§å°ä¸€ç›´åœ¨å¢é•¿ï¼ŒGo å›¢é˜Ÿæœ‰æ²¡æœ‰å…³æ³¨åˆ°è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰æ²¡æœ‰å¿…è¦è€ƒè™‘æŠŠå®ƒé™ä¸‹æ¥ï¼Ÿ'
categories: [golang]
tags: [Go, Golang, Archive, Size, Analyze]
comments: true
author: mai
---

## Golang Release Archive Size

| File name	|Kind	|OS	|Arch	|Size |
|----|----|----|----|----|
| go1.14.5.src.tar.gz	| Source |		| 21MB |
| go1.14.5.darwin-amd64.tar.gz  |	Archive  |	macOS	 | x86-64  |	119MB |
| go1.13.13.darwin-amd64.tar.gz | Archive | macOS | x86-64	 | 116MB |

![](https://raw.githubusercontent.com/yangwenmai/maiyang.me/master/blog/go-release-archive-size-2020-07-16.png)

## èƒŒæ™¯ï¼šå¥½å¥‡

Go å‘å¸ƒçš„æ–°ç‰ˆæœ¬åŒ…å¤§å°å¥½åƒæ˜¯è¶Šæ¥è¶Šå¤§äº†ï¼Œå¾ˆå¥½å¥‡æ˜¯ä¸æ˜¯è¿™æ ·çš„ï¼Œæœ‰æ²¡æœ‰å¯èƒ½åˆ¶ä½œä¸€ä¸ªè¶‹åŠ¿å›¾ï¼Ÿ

## éœ€æ±‚

è·å–æ‰€æœ‰å†å²ç‰ˆæœ¬å’Œå®ƒçš„åŒ…å¤§å°ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªåŒ…å¤§å°å¢é•¿å˜åŒ–çš„è¶‹åŠ¿å›¾ã€‚

## è®¾è®¡ï¼ˆåŠŸèƒ½æ‹†åˆ†ï¼‰

1. è·å–æ‰€æœ‰çš„å†å²ç‰ˆæœ¬å’ŒåŒ…å¤§å°ï¼›
2. æ¸²æŸ“å¢é•¿å˜åŒ–çš„è¶‹åŠ¿å›¾ï¼›

### å¦‚ä½•è·å–æ‰€æœ‰çš„å†å²ç‰ˆæœ¬å’ŒåŒ…å¤§å°å‘¢ï¼Ÿ

1. æ‰¾åˆ°æºç½‘ç«™åœ°å€ (https://golang.org/dl/)
2. é€šè¿‡ Chrome Network è·å¾—å…¶ cURL å‘½ä»¤
3. ä½¿ç”¨ https://mholt.github.io/curl-to-go æŠŠ cURL å‘½ä»¤è½¬æ¢æˆ Go http fetch ä»£ç 
4. ä½¿ç”¨ goquery è§£æç½‘é¡µ
5. åˆ†æè¿™äº›å†å²ç‰ˆæœ¬å’ŒåŒ…å¤§å°çš„â€œè¡¨ç»“æ„â€

åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è´´ä»£ç äº†

### ä»£ç ç‰‡æ®µ

```go
package main

import (
	"fmt"
	"io/ioutil"
	"log"
	"net/http"

	"github.com/PuerkitoBio/goquery"
)

func main() {
	resp := fetch()
	defer func() {
		err := resp.Body.Close()
		if err != nil {
			log.Fatal(err)
		}
	}()
	doc, err := goquery.NewDocumentFromReader(resp.Body)
	if err != nil {
		log.Fatal(err)
	}
	type releaseSize struct {
		version string
		size    string
	}
	var results []releaseSize
	doc.Find(".codetable").Each(func(i int, s *goquery.Selection) {
		s.Find("tbody>tr").Each(func(i int, s *goquery.Selection) {
			var row []string
			s.Find("td").Each(func(indexth int, tablecell *goquery.Selection) {
				row = append(row, tablecell.Text())
			})
			if len(row) == 0 {
				return
			}
			// set your fetch data config
			if row[1] == "Archive" && row[2] == "macOS" {
				results = append(results, releaseSize{
					version: row[0],
					size:    row[4],
				})
			}
		})
	})
	ret := ""
	for j := len(results) - 1; j >= 0; j-- {
		ret += fmt.Sprintf("%s,%s\n", results[j].version, results[j].size[:len(results[j].size)-2])
	}
	ioutil.WriteFile("go-release-history-archive-size.csv", []byte(ret), 0644)
}

func fetch() *http.Response {
	// Generated by curl-to-Go: https://mholt.github.io/curl-to-go

	req, err := http.NewRequest("GET", "https://golang.org/dl/", nil)
	if err != nil {
		// handle err
		panic(err)
	}
	req.Header.Set("Authority", "golang.org")
	req.Header.Set("Cache-Control", "max-age=0")
	req.Header.Set("Upgrade-Insecure-Requests", "1")
	req.Header.Set("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36")
	req.Header.Set("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9")
	req.Header.Set("Sec-Fetch-Site", "same-origin")
	req.Header.Set("Sec-Fetch-Mode", "navigate")
	req.Header.Set("Sec-Fetch-User", "?1")
	req.Header.Set("Sec-Fetch-Dest", "document")
	req.Header.Set("Referer", "https://golang.org/")
	req.Header.Set("Accept-Language", "zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7,ja;q=0.6")
	// è¯·å¡«å†™ä½ è‡ªå·±çš„ cookie
	req.Header.Set("Cookie", "...")

	resp, err := http.DefaultClient.Do(req)
	if err != nil {
		// handle err
		panic(err)
	}
	return resp
}

```

## æ€è€ƒğŸ¤”

- å¢å¤§çš„åŒ…éƒ½åŒ…æ‹¬å“ªäº›å†…å®¹å‘¢ï¼Ÿ
- Go Team æœ‰æ²¡æœ‰å…³æ³¨åˆ°è¿™ä¸ªé—®é¢˜ï¼Ÿ
- æœ‰æ²¡æœ‰å¿…è¦è€ƒè™‘æŠŠå®ƒé™ä¸‹æ¥ï¼Ÿ

----

**èŒ¶æ­‡é©¿ç«™**

ä¸€ä¸ªå¯ä»¥è®©ä½ åœä¸‹æ¥çœ‹ä¸€çœ‹ï¼Œåœ¨èŒ¶æ­‡ä¹‹ä½™ç»™ä½ å¸®åŠ©çš„å°ç«™ï¼Œè¿™é‡Œçš„å†…å®¹ä¸»è¦æ˜¯åç«¯æŠ€æœ¯ï¼Œä¸ªäººç®¡ç†ï¼Œå›¢é˜Ÿç®¡ç†ï¼Œä»¥åŠå…¶ä»–ä¸ªäººæ‚æƒ³ã€‚
